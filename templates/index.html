<!DOCTYPE html>
<html lang="en">
<head>
  <title>SmartCrop  Prediction</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: url("https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=1600&q=80") no-repeat center center/cover;
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      color: #2E7D32;
      position: relative;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 1.2s ease-out forwards;
    }
    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(50px); }
      60% { opacity: 1; transform: translateY(-5px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.45);
      z-index: 0;
      animation: fadeOverlay 1s ease-in;
    }
    @keyframes fadeOverlay {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(90deg, #1B5E20, #388E3C, #66BB6A);
      color: white;
      padding: 12px 25px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      position: relative;
      z-index: 2;
      animation: slideDown 1s ease-out;
    }
    @keyframes slideDown {
      from { transform: translateY(-70px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .brand img {
      height: 65px;
      width: 65px;
      border-radius: 50%;
      border: 2px solid #C8E6C9;
      box-shadow: 0 0 10px #A5D6A7;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: pulseGlow 3s infinite ease-in-out;
    }
    @keyframes pulseGlow {
      0%,100% { box-shadow: 0 0 10px #A5D6A7; transform: scale(1); }
      50% { box-shadow: 0 0 20px #81C784; transform: scale(1.05); }
    }
    .brand img:hover {
      transform: scale(1.08);
      box-shadow: 0 0 15px #81C784;
    }
    .brand span {
      font-weight: 700;
      font-size: 26px;
      background: linear-gradient(to right, #AEEA00, #C0CA33, #FFF176);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
      animation: fadeInText 1.2s ease-in-out;
    }
    @keyframes fadeInText {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .btn-logout {
      background-color: #E53935;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
    }
    .btn-logout:hover { background-color: #C62828; }
    .language-select {
      border-radius: 8px;
      border: 1px solid #A5D6A7;
      padding: 6px 8px;
      background-color: #F1F8E9;
      color: #1B5E20;
      font-weight: 600;
    }

    .card {
      margin-top: 40px;
      border-radius: 20px;
      padding: 30px;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(6px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      animation: floatUpCard 1.2s ease-out;
    }
    @keyframes floatUpCard {
      from { opacity: 0; transform: translateY(60px); }
      to { opacity: 1; transform: translateY(0); }
    }

    label { font-weight: 600; }
    .btn-success { background: #2E7D32; border: none; }
    .btn-success:hover { background: #1B5E20; }

    footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: linear-gradient(90deg, #2E7D32, #43A047, #66BB6A);
      color: white;
      text-align: center;
      padding: 8px 0;
      font-size: 15px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
      opacity: 0;
      animation: fadeInFooter 1.5s ease-in forwards;
      animation-delay: 1s;
    }
    @keyframes fadeInFooter { to { opacity: 0.95; } }
    footer a { color: #FFF9C4; text-decoration: none; }
    footer a:hover { text-decoration: underline; color: #FFFF8D; }

    .toast-message {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(56, 142, 60, 0.95);
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 600;
      z-index: 9999;
      opacity: 0;
      animation: fadeToast 2.5s ease-in-out forwards;
    }
    @keyframes fadeToast {
      0% { opacity: 0; transform: translateY(-10px); }
      15% { opacity: 1; transform: translateY(0); }
      85% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-10px); }
    }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <!-- Header -->
  <div class="top-bar">
    <div class="brand">
      <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="Logo">
      <span id="appBrand" data-original="üå± SmartCrop">üå± SmartCrop</span>
    </div>

    <div>
      üåê
      <select id="languageSelect" class="language-select">
        <option value="english" {% if lang == 'english' %}selected{% endif %}>English</option>
        <option value="hi" {% if lang == 'hi' %}selected{% endif %}>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="te" {% if lang == 'te' %}selected{% endif %}>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
      </select>
      <button class="btn-logout ms-2" id="logoutBtn" onclick="window.location.href='/logout'">Logout</button>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="toast-message {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Prediction Form -->
  <div class="container">
    <div class="card">
      <h3 class="text-center mb-4" id="pageTitle" data-original="üåæ Crop Recommendation">üåæ Crop Recommendation</h3>

      <form action="/predict" method="POST" id="predictForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label id="nLabel" data-original="Nitrogen (N) [0‚Äì150]">Nitrogen (N) [0‚Äì150]</label>
            <input name="N" type="number" min="0" max="150" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label id="pLabel" data-original="Phosphorus (P) [0‚Äì150]">Phosphorus (P) [0‚Äì150]</label>
            <input name="P" type="number" min="0" max="150" class="form-control" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label id="kLabel" data-original="Potassium (K) [0‚Äì210]">Potassium (K) [0‚Äì210]</label>
            <input name="K" type="number" min="0" max="210" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label id="tLabel" data-original="Temperature (¬∞C) [10‚Äì50]">Temperature (¬∞C) [10‚Äì50]</label>
            <input name="temperature" type="number" min="10" max="50" class="form-control" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label id="hLabel" data-original="Humidity (%) [10‚Äì100]">Humidity (%) [10‚Äì100]</label>
            <input name="humidity" type="number" min="10" max="100" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label id="phLabel" data-original="pH Value [3‚Äì10]">pH Value [3‚Äì10]</label>
            <input name="ph" type="number" step="0.1" min="3" max="10" class="form-control" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label id="rLabel" data-original="Rainfall (mm) [20‚Äì300]">Rainfall (mm) [20‚Äì300]</label>
            <input name="rainfall" type="number" min="20" max="300" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label id="soilLabel" data-original="Soil Type">Soil Type</label>
            <select name="soil" id="soilSelect" class="form-select">
              <option value="red" data-original="Red Soil">Red Soil</option>
              <option value="black" data-original="Black Soil">Black Soil</option>
              <option value="sandy" data-original="Sandy Soil">Sandy Soil</option>
              <option value="loamy" data-original="Loamy Soil">Loamy Soil</option>
              <option value="clayey" data-original="Clayey Soil">Clayey Soil</option>
            </select>
          </div>
        </div>

        <button type="submit" class="btn btn-success w-100 mt-3" id="predictBtn" data-original="Predict Crop">Predict Crop</button>
      </form>
    </div>
  </div>

  <footer>
    üßë‚Äçüíª Developed by <b>Akhil Lade</b> | üìß <a href="mailto:akhillade@gmail.com">akhillade@gmail.com</a>
  </footer>

  <script>
    const langCodes = { english: 'en', hi: 'hi', te: 'te' };
    const translatableIds = ['appBrand','pageTitle','nLabel','pLabel','kLabel','tLabel','hLabel','phLabel','rLabel','soilLabel','predictBtn'];
    const soilOptions = Array.from(document.querySelectorAll('#soilSelect option'));
    const select = document.getElementById('languageSelect');

    async function setServerLang(lang) {
      try {
        await fetch('/set_language', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ lang })
        });
      } catch (e) { console.warn('Could not set server language:', e); }
    }

    async function translateText(text, targetCode) {
      if (!text || !text.trim()) return text;
      if (targetCode === 'en') return text;
      const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetCode}&dt=t&q=${encodeURIComponent(text)}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        if (Array.isArray(data) && data[0] && data[0][0]) return data[0][0][0];
      } catch (err) { console.warn('Translation error', err); }
      return text;
    }

    async function translatePage(langKey) {
      const target = langCodes[langKey] || 'en';
      if (target === 'en') {
        translatableIds.forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          const orig = el.getAttribute('data-original');
          if (orig) el.textContent = orig;
        });
        soilOptions.forEach(opt => {
          const orig = opt.getAttribute('data-original');
          if (orig) opt.textContent = orig;
        });
        localStorage.setItem('smartcrop_lang', 'english');
        await setServerLang('english');
        return;
      }

      for (const id of translatableIds) {
        const el = document.getElementById(id);
        if (!el) continue;
        const orig = el.getAttribute('data-original') || el.textContent;
        const translated = await translateText(orig, target);
        el.textContent = translated;
      }

      for (const opt of soilOptions) {
        const orig = opt.getAttribute('data-original') || opt.textContent;
        const translated = await translateText(orig, target);
        opt.textContent = translated;
      }

      localStorage.setItem('smartcrop_lang', langKey);
      await setServerLang(langKey);
    }

    window.addEventListener('DOMContentLoaded', async () => {
      const saved = localStorage.getItem('smartcrop_lang') || '{{ lang if lang is defined else "english" }}';
      if (saved && saved !== 'english') {
        select.value = saved;
        translatePage(saved);
      } else {
        translatableIds.forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          const orig = el.getAttribute('data-original');
          if (orig) el.textContent = orig;
        });
      }
    });

    select.addEventListener('change', async (e) => {
      const chosen = e.target.value;
      await translatePage(chosen);
    });
  </script>
</body>
</html>
