<!DOCTYPE html>
<html lang="en">
<head>
  <title>SmartCropResult</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: url("https://images.unsplash.com/photo-1617196035933-cf4d1a57fdd4?auto=format&fit=crop&w=1600&q=80")
        no-repeat center center/cover;
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      position: relative;
      color: #1B5E20;
    }
    .overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 0;
    }
    .top-bar {
      display: flex; justify-content: space-between; align-items: center;
      background: linear-gradient(90deg, #1B5E20, #388E3C, #66BB6A);
      color: white; padding: 12px 25px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      position: relative; z-index: 2;
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .brand img {
      height: 65px; width: 65px; border-radius: 50%;
      border: 2px solid #C8E6C9; box-shadow: 0 0 10px #A5D6A7;
    }
    .brand span {
      font-weight: 700; font-size: 26px;
      background: linear-gradient(to right, #AEEA00, #C0CA33, #FFF176);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .language-select {
      border-radius: 8px; border: 1px solid #A5D6A7;
      padding: 6px 8px; background-color: #F1F8E9;
      color: #1B5E20; font-weight: 600;
    }
    .btn-logout {
      background-color: #E53935; color: white; border: none;
      border-radius: 8px; padding: 6px 12px;
    }
    .card {
      border-radius: 20px; background: rgba(255,255,255,0.9);
      padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      max-width: 650px; margin: 80px auto;
    }
    footer {
      position: fixed; bottom: 0; width: 100%;
      background: linear-gradient(90deg, #2E7D32, #43A047, #66BB6A);
      color: white; text-align: center;
      padding: 8px 0; font-size: 15px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
      opacity: 0.95;
    }
    footer a { color: #FFF9C4; text-decoration: none; }
    footer a:hover { text-decoration: underline; color: #FFFF8D; }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <!-- Header -->
  <div class="top-bar">
    <div class="brand">
      <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="Logo">
      <span id="appBrand" data-original="üå± SmartCrop">üå± SmartCrop</span>
    </div>
    <div>
      üåê
      <select id="languageSelect" class="language-select">
        <option value="english" {% if lang=='english' %}selected{% endif %}>English</option>
        <option value="hi" {% if lang=='hi' %}selected{% endif %}>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="te" {% if lang=='te' %}selected{% endif %}>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
      </select>
      <button class="btn-logout ms-2" onclick="window.location.href='/logout'">Logout</button>
    </div>
  </div>

  <!-- Result Section -->
  <div class="card text-center">
    <h2 id="resultTitle" data-original="üåæ Recommended Crop">üåæ Recommended Crop</h2>
    <h3 class="text-success" id="cropName" data-original="{{ crop }}">{{ crop }}</h3>
    <p><b id="tipLabel" data-original="Tip:">Tip:</b> <span id="tipText" data-original="{{ tip }}">{{ tip }}</span></p>
    <p><b id="fertLabel" data-original="Fertilizer Advice:">Fertilizer Advice:</b> 
      <span id="fertText" data-original="{{ fertilizer }}">{{ fertilizer }}</span>
    </p>
    <a href="/" class="btn btn-outline-success mt-3" id="backBtn" data-original="üîô Back">üîô Back</a>
  </div>

  <footer>
    üßë‚Äçüíª Developed by <b>Akhil Lade</b> |
    üìß <a href="mailto:akhillade@gmail.com">akhillade@gmail.com</a>
  </footer>

  <!-- üåê Translation Script -->
  <script>
    const select = document.getElementById('languageSelect');
    const langCodes = { english: 'en', hi: 'hi', te: 'te' };

    const translatableIds = [
      'appBrand', 'resultTitle', 'cropName', 'tipLabel',
      'fertLabel', 'tipText', 'fertText', 'backBtn'
    ];

    // Translate using Google Translate public endpoint
    async function translateText(text, targetCode) {
      if (!text || targetCode === 'en') return text;
      try {
        const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetCode}&dt=t&q=${encodeURIComponent(text)}`);
        const data = await res.json();
        return data[0][0][0];
      } catch (err) {
        console.warn('Translation error:', err);
        return text;
      }
    }

    // Translate all visible elements
    async function translatePage(langKey) {
      const targetCode = langCodes[langKey] || 'en';

      // English ‚Üí restore original text
      if (targetCode === 'en') {
        translatableIds.forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            const original = el.getAttribute('data-original');
            if (original) el.textContent = original;
          }
        });
        localStorage.setItem('smartcrop_lang', 'english');
        return;
      }

      // Translate dynamically
      for (const id of translatableIds) {
        const el = document.getElementById(id);
        if (el) {
          const original = el.getAttribute('data-original') || el.textContent;
          const translated = await translateText(original, targetCode);
          el.textContent = translated;
        }
      }
      localStorage.setItem('smartcrop_lang', langKey);
    }

    // Restore saved language on load
    window.onload = () => {
      const savedLang = localStorage.getItem('smartcrop_lang') || 'english';
      select.value = savedLang;
      if (savedLang !== 'english') translatePage(savedLang);
    };

    // On language change
    select.addEventListener('change', e => translatePage(e.target.value));
  </script>
</body>
</html>
